(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var e=function(){function e(t){var n=this,r=t.name,o=t.link,i=t.likes,u=t._id,a=t.owner,c=t.currentUserId,s=t.template,l=t.handleClickCard,f=t.handleRemoveCard,p=t.handleLike;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=r,this._link=o,this._likes=i,this._cardId=u,this._ownerId=a._id,this._curentOwnerId=c,this._template=document.querySelector(s).content.querySelector(".elements__element"),this._handleClickCard=l,this._handleRemoveCard=f,this._handleLike=p,this._isLiked=this._likes.some((function(t){return t._id===n._curentOwnerId}))}var n,r;return n=e,(r=[{key:"getCard",value:function(){return this._card=this._template.cloneNode(!0),this._cardImage=this._card.querySelector(".elements__image"),this._cardImageCaption=this._card.querySelector(".elements__title"),this._cardLikeButton=this._card.querySelector(".elements__like"),this._cardLikeCounter=this._card.querySelector(".elements__like-counter"),this._cardDeleteButton=this._card.querySelector(".elements__delete-button"),this._cardImage.src=this._link,this._cardImage.alt=this._name,this._cardImageCaption.textContent=this._name,this._cardLikeCounter.textContent=this._likes.length,this._showLikeButtonState(),this._hideRemoveButton(),this._setEventListeners(),this._card}},{key:"_hideRemoveButton",value:function(){this._curentOwnerId!==this._ownerId&&this._cardDeleteButton.classList.add("elements__delete-button_inactive")}},{key:"_showLikeButtonState",value:function(){this._isLiked&&this._cardLikeButton.classList.add("elements__like_active")}},{key:"getIsLiked",value:function(){return this._isLiked}},{key:"removeCard",value:function(){this._card.remove(),this._card=null}},{key:"_likeFunction",value:function(t){this._isLiked?(this._cardLikeButton.classList.remove("elements__like_active"),this._cardLikeCounter.textContent=t.likes.length,this._isLiked=!this._isLiked):(this._cardLikeButton.classList.add("elements__like_active"),this._cardLikeCounter.textContent=t.likes.length,this._isLiked=!this._isLiked)}},{key:"_setEventListeners",value:function(){var t=this;this._cardDeleteButton.addEventListener("click",(function(){return t._handleRemoveCard()})),this._cardLikeButton.addEventListener("click",(function(){return t._handleLike()})),this._cardImage.addEventListener("click",(function(){return t._handleClickCard()}))}}])&&t(n.prototype,r),e}();function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var r=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._formElement=document.querySelector(n),this._inputElements=Array.from(this._formElement.querySelectorAll(e.inputSelector)),this._submitButton=this._formElement.querySelector(e.submitButtonSelector),this._inactiveButtonStatus=e.inactiveButtonClass,this._inputError=e.inputErrorClass}var e,r;return e=t,(r=[{key:"_showError",value:function(t){this._formElement.querySelector("#".concat(t.id,"-error")).textContent=t.validationMessage,t.classList.add(this._inputErrorClass)}},{key:"_hideError",value:function(t){this._formElement.querySelector("#".concat(t.id,"-error")).textContent=" ",t.classList.remove(this._inputErrorClass)}},{key:"_checkInputValidity",value:function(t){t.checkValidity()?this._hideError(t):this._showError(t)}},{key:"toggleButtonState",value:function(){this._formElement.checkValidity()?(this._submitButton.classList.remove(this._inactiveButtonStatus),this._submitButton.disabled=!1):(this._submitButton.classList.add(this._inactiveButtonStatus),this._submitButton.disabled=!0)}},{key:"_setEventListeners",value:function(){var t=this;this._formElement.addEventListener("submit",(function(t){t.preventDefault()})),this._inputElements.forEach((function(e){t._hideError(e),e.addEventListener("input",(function(){t._checkInputValidity(e),t.toggleButtonState()}))}))}},{key:"hideErrors",value:function(){var t=this;this._inputElements.forEach((function(e){t._hideError(e)}))}},{key:"enableValidation",value:function(){this.toggleButtonState(),this._setEventListeners()}}])&&n(e.prototype,r),t}();function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=e}var e,n;return e=t,(n=[{key:"addItem",value:function(t){this._container.prepend(t)}}])&&o(e.prototype,n),t}();function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._popup=e,this._popupOpenedSelector="popup_opened",this._closeButton=this._popup.querySelector(".popup__close-button"),this._handleEscClose=this._handleEscClose.bind(this)}var e,n;return e=t,(n=[{key:"open",value:function(){this._popup.classList.add(this._popupOpenedSelector),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove(this._popupOpenedSelector),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handleEscClose",value:function(t){"Escape"===t.key&&this.close()}},{key:"_closeClickOverlay",value:function(t){t.target===t.currentTarget&&this.close()}},{key:"setEventListeners",value:function(){this._closeButton.addEventListener("click",this.close.bind(this)),this._popup.addEventListener("click",this._closeClickOverlay.bind(this))}}])&&u(e.prototype,n),t}();function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,e,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function p(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(u,t);var e,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=h(r);if(o){var n=h(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return p(this,t)});function u(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(e=i.call(this,t))._popupImage=e._popup.querySelector(".popup__picture-image"),e._popupCaption=e._popup.querySelector(".popup__title-image"),e}return e=u,(n=[{key:"open",value:function(t,e){this._popupImage.src=e,this._popupImage.alt=t,this._popupCaption.textContent=t,l(h(u.prototype),"open",this).call(this)}}])&&s(e.prototype,n),u}(a);function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function v(t,e,n){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=k(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function m(t,e){return(m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function b(t,e){return!e||"object"!==d(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var g=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)}(u,t);var e,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=k(r);if(o){var n=k(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return b(this,t)});function u(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(n=i.call(this,t))._popupForm=n._popup.querySelector(".popup__form"),n._submitButton=n._popupForm.querySelector(".popup__save-button"),n._inputFields=Array.from(n._popupForm.querySelectorAll(".popup__input")),n.submitFormHandler=e,n}return e=u,(n=[{key:"_toggleButtonState",value:function(t){this._submitButton.textContent=t?"Сохранение...":"Сохранить"}},{key:"_getInputValues",value:function(){var t=this;return this._inputValues={},this._inputFields.forEach((function(e){t._inputValues[e.name]=e.value})),this._inputValues}},{key:"_submitHandler",value:function(){event.preventDefault(),this.submitFormHandler(this._getInputValues()),this._toggleButtonState(!0)}},{key:"setEventListeners",value:function(){v(k(u.prototype),"setEventListeners",this).call(this),this._popupForm.addEventListener("submit",this._submitHandler.bind(this))}},{key:"close",value:function(){v(k(u.prototype),"close",this).call(this),this._popupForm.reset()}}])&&y(e.prototype,n),u}(a);function S(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var E=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._avatarProfile=e,this._profileName=n,this._profileAboutMe=r}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(){return this._profileInfo={},this._profileInfo.name=this._profileName.textContent,this._profileInfo.job=this._profileAboutMe.textContent,this._profileInfo}},{key:"getUserId",value:function(){return this._currentUserId}},{key:"setUserAvatar",value:function(t){this._avatarProfile.src=t}},{key:"setUserInfo",value:function(t,e,n){this._profileName.textContent=t,this._profileAboutMe.textContent=e,this._currentUserId=n}}])&&S(e.prototype,n),t}();function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function C(t,e,n){return(C="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=P(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function L(t,e){return(L=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function j(t,e){return!e||"object"!==w(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function P(t){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var I=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&L(t,e)}(u,t);var e,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=P(r);if(o){var n=P(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return j(this,t)});function u(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),i.call(this,t)}return e=u,(n=[{key:"setRemove",value:function(t){this._handleSubmitCallback=t}},{key:"_submitHandler",value:function(){event.preventDefault(),this._handleSubmitCallback()}},{key:"setEventListeners",value:function(){C(P(u.prototype),"setEventListeners",this).call(this),this._popup.addEventListener("submit",this._submitHandler.bind(this))}}])&&O(e.prototype,n),u}(a);function R(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var B=function(){function t(e){var n=e.token,r=e.url;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._token=n,this._url=r}var e,n;return e=t,(n=[{key:"_getResponse",value:function(t){return t.ok?t.json():Promise.reject("Произошла ошибка")}},{key:"getUserInformation",value:function(){return fetch("".concat(this._url,"/users/me"),{headers:{authorization:this._token}}).then(this._getResponse)}},{key:"getCards",value:function(){return fetch("".concat(this._url,"/cards"),{headers:{authorization:this._token}}).then(this._getResponse)}},{key:"editUserInfo",value:function(t,e){return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:e})}).then(this._getResponse)}},{key:"addNewCard",value:function(t){var e=t.name,n=t.link;return fetch("".concat(this._url,"/cards"),{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e,link:n})}).then(this._getResponse)}},{key:"removeCard",value:function(t){return fetch("".concat(this._url,"/cards/").concat(t),{method:"DELETE",headers:{authorization:this._token}}).then(this._getResponse)}},{key:"likeCard",value:function(t){return fetch("".concat(this._url,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:this._token}}).then(this._getResponse)}},{key:"dislikeCard",value:function(t){return fetch("".concat(this._url,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:this._token}}).then(this._getResponse)}},{key:"editUserAvatar",value:function(t){return fetch("".concat(this._url,"/users/me/avatar "),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(this._getResponse)}}])&&R(e.prototype,n),t}();function q(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function T(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function U(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?T(Object(n),!0).forEach((function(e){x(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function x(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var D=document.querySelector(".popup_profile"),A=(D.querySelector(".popup__form"),document.querySelector(".profile__name")),V=document.querySelector(".profile__text"),F=document.querySelector(".popup__input_type_name"),N=document.querySelector(".popup__input_type_text"),z=document.querySelector(".popup_elements"),H=(document.querySelector("#popup_elements-add"),document.querySelector(".profile__add-button")),M=document.querySelector(".profile__edit-button"),J=document.querySelector(".profile__avatar"),$=document.querySelector(".template"),G=document.querySelector(".photo"),K=document.querySelector(".popup_remove-card"),Q=document.querySelector(".popup_avatar-update"),W=document.querySelector(".profile__change-avatar-button"),X={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:".popup__input_state_invalid"},Y=new r(X,".popup__form_profile");Y.enableValidation();var Z=new r(X,".popup__form_add");Z.enableValidation();var tt=new r(X,".popup__form_avatar-update");tt.enableValidation();var et=new _(G),nt=new I(K),rt=new B({token:"8979d512-ff50-43b0-b88b-551975431ae7",url:"https://mesto.nomoreparties.co/v1/cohort-18"}),ot=new i($),it=function(t){var n=new e(U(U({},t),{},{currentUserId:lt.getUserId(),template:".elements",handleClickCard:function(){et.open(t.name,t.link)},handleRemoveCard:function(){!function(t,e){nt.setRemove((function(){rt.removeCard(t).then((function(){return e.removeCard()})).then((function(){return nt.close()})).catch((function(t){return console.log(t)}))})),nt.open()}(t._id,n)},handleLike:function(){!function(t,e){(e.getIsLiked()?rt.dislikeCard(t):rt.likeCard(t)).then((function(t){return e._likeFunction(t)})).catch((function(t){return console.log(t)}))}(t._id,n)}}));ut(n)},ut=function(t){var e=t.getCard();ot.addItem(e)},at=new g(z,(function(t){rt.addNewCard(t).then((function(t){it(t)})).then((function(){at.close()})).catch((function(t){console.log(t)}))})),ct=new g(D,(function(t){var e=t.name,n=t.about;rt.editUserInfo(e,n).then((function(t){lt.setUserInfo(t.name,t.about)})).then((function(){ct.close()})).catch((function(t){console.log(t)}))})),st=new g(Q,(function(t){var e=t.avatarlink;rt.editUserAvatar(e).then((function(t){lt.setUserAvatar(t.avatar)})).then((function(){st.close()})).catch((function(t){console.log(t)}))})),lt=new E(J,A,V);Promise.all([rt.getUserInformation(),rt.getCards()]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}return n}}(e,n)||function(t,e){if(t){if("string"==typeof t)return q(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?q(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];lt.setUserInfo(o.name,o.about,o._id),lt.setUserAvatar(o.avatar),i.reverse().forEach((function(t){it(t)}))})).catch((function(t){console.log(t)})),H.addEventListener("click",(function(){Z.hideErrors(),Z.toggleButtonState(),at.open()})),M.addEventListener("click",(function(){var t=lt.getUserInfo();F.value=t.name,N.value=t.job,ct.open(),Y.hideErrors(),Y.toggleButtonState()})),et.setEventListeners(),at.setEventListeners(),ct.setEventListeners(),W.addEventListener("click",(function(){tt.toggleButtonState(),tt.hideErrors(),st.open()})),st.setEventListeners(),nt.setEventListeners()})();